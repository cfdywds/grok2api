# 图片管理功能演示指南

## 🎬 功能演示流程

### 演示 1: 生成图片并查看元数据

#### 步骤 1: 启动服务
```bash
cd D:\navy_code\github_code\grok2api
python main.py
```

#### 步骤 2: 生成图片
使用 API 生成图片：
```bash
curl -X POST http://localhost:8000/v1/images/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "prompt": "a beautiful sunset over the ocean with palm trees",
    "model": "grok-imagine-1.0",
    "n": 2,
    "size": "1024x1024"
  }'
```

或访问 Imagine 页面：
```
http://localhost:8000/admin/imagine
```

#### 步骤 3: 查看图片管理页面
访问：
```
http://localhost:8000/admin/gallery
```

**预期结果**：
- ✅ 看到刚生成的图片
- ✅ 显示提示词、模型、时间等信息
- ✅ 统计卡片显示正确的数量

---

### 演示 2: 筛选和排序

#### 步骤 1: 搜索图片
1. 在搜索框输入 "sunset"
2. 点击"筛选"按钮

**预期结果**：
- ✅ 只显示包含 "sunset" 的图片

#### 步骤 2: 按模型筛选
1. 选择模型 "grok-imagine-1.0"
2. 点击"筛选"按钮

**预期结果**：
- ✅ 只显示该模型生成的图片

#### 步骤 3: 排序
1. 选择排序 "大小降序"
2. 点击"筛选"按钮

**预期结果**：
- ✅ 图片按文件大小从大到小排列

---

### 演示 3: 视图切换

#### 步骤 1: 网格视图（默认）
**预期结果**：
- ✅ 图片以卡片形式展示
- ✅ 每张图片显示缩略图、提示词、比例、大小
- ✅ 鼠标悬停有阴影效果

#### 步骤 2: 列表视图
1. 点击列表视图按钮（☰）

**预期结果**：
- ✅ 图片以列表形式展示
- ✅ 显示更多信息（模型、时间等）
- ✅ 更紧凑的布局

---

### 演示 4: 批量操作

#### 步骤 1: 选择图片
1. 勾选 2-3 张图片的复选框

**预期结果**：
- ✅ 复选框被选中
- ✅ "导出"和"删除"按钮变为可用状态

#### 步骤 2: 全选
1. 点击"全选"按钮

**预期结果**：
- ✅ 当前页所有图片被选中
- ✅ 再次点击"全选"取消选择

#### 步骤 3: 导出图片
1. 选择几张图片
2. 点击"导出"按钮

**预期结果**：
- ✅ 下载一个 ZIP 文件
- ✅ ZIP 文件包含选中的所有图片

#### 步骤 4: 删除图片
1. 选择一张测试图片
2. 点击"删除"按钮
3. 确认删除

**预期结果**：
- ✅ 显示确认对话框
- ✅ 图片从列表中消失
- ✅ 文件和元数据都被删除
- ✅ 统计信息更新

---

### 演示 5: 图片详情和标签管理

#### 步骤 1: 查看详情
1. 点击任意图片卡片

**预期结果**：
- ✅ 弹出详情窗口
- ✅ 显示大图
- ✅ 显示完整的元数据信息

#### 步骤 2: 添加标签
1. 在"添加标签"输入框输入 "beautiful"
2. 按回车或点击"添加"按钮

**预期结果**：
- ✅ 标签立即显示在标签列表中
- ✅ 关闭弹窗后，图片卡片上显示新标签

#### 步骤 3: 删除标签
1. 点击标签上的 "×" 按钮

**预期结果**：
- ✅ 标签立即从列表中消失
- ✅ 图片卡片上的标签也消失

#### 步骤 4: 下载图片
1. 在详情弹窗中点击"下载"按钮

**预期结果**：
- ✅ 图片被下载到本地

#### 步骤 5: 删除单张图片
1. 在详情弹窗中点击"删除"按钮
2. 确认删除

**预期结果**：
- ✅ 显示确认对话框
- ✅ 弹窗关闭
- ✅ 图片从列表中消失

---

### 演示 6: 统计信息

#### 查看统计卡片
**预期结果**：
- ✅ **图片总数**: 显示正确的总数
- ✅ **总大小**: 显示正确的文件大小（MB）
- ✅ **本月新增**: 显示本月生成的图片数量
- ✅ **常用标签**: 显示使用最多的前 3 个标签

---

### 演示 7: 分页功能

#### 步骤 1: 生成大量图片
生成 60+ 张图片（超过一页）

#### 步骤 2: 测试分页
1. 查看页面底部的分页组件

**预期结果**：
- ✅ 显示 "第 1 页 / 共 2 页"
- ✅ "上一页"按钮禁用
- ✅ "下一页"按钮可用

#### 步骤 3: 翻页
1. 点击"下一页"按钮

**预期结果**：
- ✅ 显示第 2 页的图片
- ✅ "上一页"按钮可用
- ✅ "下一页"按钮禁用（如果是最后一页）

---

### 演示 8: 响应式设计

#### 步骤 1: 桌面端
在桌面浏览器中访问

**预期结果**：
- ✅ 网格视图显示 4-5 列
- ✅ 工具栏横向排列
- ✅ 详情弹窗左右分栏

#### 步骤 2: 移动端
1. 按 F12 打开开发者工具
2. 切换到移动设备模拟

**预期结果**：
- ✅ 网格视图显示 2 列
- ✅ 工具栏纵向排列
- ✅ 详情弹窗上下分栏
- ✅ 所有功能正常工作

---

## 🎯 验收检查清单

### 功能检查

- [ ] 图片生成后自动保存元数据
- [ ] 图片列表正确显示
- [ ] 搜索功能正常工作
- [ ] 模型筛选正常工作
- [ ] 宽高比筛选正常工作
- [ ] 排序功能正常工作
- [ ] 网格视图正常显示
- [ ] 列表视图正常显示
- [ ] 批量选择正常工作
- [ ] 全选功能正常工作
- [ ] 批量导出正常工作
- [ ] 批量删除正常工作
- [ ] 图片详情弹窗正常显示
- [ ] 添加标签正常工作
- [ ] 删除标签正常工作
- [ ] 下载图片正常工作
- [ ] 删除单张图片正常工作
- [ ] 统计信息正确显示
- [ ] 分页功能正常工作
- [ ] 响应式设计正常工作

### 数据一致性检查

- [ ] 删除图片后元数据同步删除
- [ ] 清空缓存后元数据同步清空
- [ ] 标签更新后立即生效
- [ ] 统计信息实时更新

### 性能检查

- [ ] 页面加载速度快（< 2 秒）
- [ ] 图片列表加载流畅
- [ ] 筛选响应快速
- [ ] 批量操作不卡顿
- [ ] 大量图片时性能良好

### UI/UX 检查

- [ ] 界面美观
- [ ] 交互流畅
- [ ] 按钮状态正确
- [ ] 错误提示友好
- [ ] 加载状态清晰
- [ ] 空状态提示明确

---

## 📸 截图示例

### 1. 图片管理主页面
```
┌─────────────────────────────────────────────────────────┐
│  Grok2API                                    [图片管理]  │
├─────────────────────────────────────────────────────────┤
│  📊 图片总数: 42    💾 总大小: 125 MB                   │
│  📅 本月新增: 15    🏷️ 常用标签: sunset, ocean, nature │
├─────────────────────────────────────────────────────────┤
│  [搜索框] [模型▼] [比例▼] [排序▼] [筛选] [重置]        │
│  [⊞网格] [☰列表] [全选] [导出] [删除]                  │
├─────────────────────────────────────────────────────────┤
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                       │
│  │ ☑️  │ │ ☑️  │ │ ☐  │ │ ☐  │                       │
│  │[图片]│ │[图片]│ │[图片]│ │[图片]│                       │
│  │提示词│ │提示词│ │提示词│ │提示词│                       │
│  │1:1 2M│ │2:3 3M│ │1:1 2M│ │16:9 4M│                      │
│  └─────┘ └─────┘ └─────┘ └─────┘                       │
│                                                          │
│  [上一页]  第 1 页 / 共 3 页  [下一页]                  │
└─────────────────────────────────────────────────────────┘
```

### 2. 图片详情弹窗
```
┌─────────────────────────────────────────────────────────┐
│  图片详情                                          [×]   │
├──────────────────────┬──────────────────────────────────┤
│                      │  提示词: a beautiful sunset...   │
│                      │  模型: grok-imagine-1.0          │
│     [大图显示]       │  宽高比: 1:1                     │
│                      │  尺寸: 1024 × 1024               │
│                      │  文件大小: 2.5 MB                │
│                      │  创建时间: 2026-02-07 23:00      │
│                      │  标签: [sunset] [ocean] [×]      │
│                      │  添加标签: [输入框] [添加]       │
│                      │  [下载] [删除]                   │
└──────────────────────┴──────────────────────────────────┘
```

---

## 🐛 常见问题排查

### 问题 1: 页面无法访问
**检查**:
```bash
# 1. 确认服务已启动
ps aux | grep python

# 2. 检查端口是否被占用
netstat -ano | findstr :8000

# 3. 查看服务日志
tail -f logs/app.log
```

### 问题 2: 图片不显示
**检查**:
```bash
# 1. 确认图片文件存在
ls data/tmp/image/

# 2. 检查文件权限
ls -la data/tmp/image/

# 3. 测试文件服务
curl http://localhost:8000/v1/files/image/test.jpg
```

### 问题 3: 元数据未保存
**检查**:
```bash
# 1. 查看元数据文件
cat data/image_metadata.json

# 2. 检查文件权限
ls -la data/

# 3. 查看服务日志
grep "保存图片元数据" logs/app.log
```

### 问题 4: 统计信息不准确
**解决**:
```python
# 运行清理脚本
python -c "
import asyncio
from app.services.gallery.service import get_image_metadata_service

async def cleanup():
    service = get_image_metadata_service()
    count = await service.cleanup_orphaned_metadata()
    print(f'Cleaned up {count} orphaned entries')

asyncio.run(cleanup())
"
```

---

## 📊 性能基准

### 预期性能指标

| 操作 | 预期时间 | 说明 |
|------|----------|------|
| 页面加载 | < 2 秒 | 首次加载 |
| 图片列表加载 | < 1 秒 | 50 张图片 |
| 搜索筛选 | < 0.5 秒 | 实时响应 |
| 批量导出 | < 5 秒 | 10 张图片 |
| 批量删除 | < 2 秒 | 10 张图片 |
| 标签更新 | < 0.5 秒 | 单张图片 |

### 性能测试

```bash
# 测试 API 响应时间
time curl http://localhost:8000/api/v1/admin/gallery/stats

# 测试图片列表加载
time curl http://localhost:8000/api/v1/admin/gallery/images?page=1&page_size=50

# 测试批量操作
time curl -X POST http://localhost:8000/api/v1/admin/gallery/images/delete \
  -H "Content-Type: application/json" \
  -d '{"image_ids": ["id1", "id2"]}'
```

---

## 🎓 使用技巧

### 技巧 1: 快速查找图片
1. 使用搜索框输入关键词
2. 结合模型和比例筛选
3. 按时间排序找到最新的

### 技巧 2: 批量管理
1. 使用全选快速选择当前页
2. 翻页继续选择更多图片
3. 一次性导出或删除

### 技巧 3: 标签组织
1. 为图片添加有意义的标签
2. 使用标签快速分类
3. 定期整理标签

### 技巧 4: 定期清理
1. 按时间排序找到旧图片
2. 批量删除不需要的图片
3. 释放存储空间

### 技巧 5: 导出备份
1. 定期导出重要图片
2. 保存到外部存储
3. 防止数据丢失

---

## 🎉 演示完成

完成以上所有演示后，你应该已经：
- ✅ 熟悉了所有核心功能
- ✅ 了解了使用技巧
- ✅ 掌握了故障排查方法
- ✅ 验证了系统正常工作

**开始使用图片管理功能吧！** 🚀
