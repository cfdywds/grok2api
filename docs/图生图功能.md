# 图生图功能使用指南

## 功能概述

图生图（Image to Image）功能允许你上传参考图片，通过 AI 进行风格转换、图片编辑和创意改造。

## 访问地址

```
http://localhost:8000/admin/img2img
```

或通过导航菜单：**功能玩法 → 图生图**

## 功能特性

### 📸 图片上传
- ✅ 支持点击上传和拖拽上传
- ✅ 支持多张图片（最多 16 张）
- ✅ 支持格式：PNG、JPEG、WebP
- ✅ 单张最大 50MB
- ✅ 实时预览和单张删除

### ✍️ 编辑设置
- ✅ 文本提示词输入
- ✅ 生成数量选择（1-4 张）
- ✅ 输出格式选择（Base64/URL）
- ✅ 流式/非流式切换

### 🎨 结果展示
- ✅ 网格布局展示
- ✅ 图片预览弹窗
- ✅ 单张下载
- ✅ 批量下载（ZIP 打包）
- ✅ 清空结果

## 使用流程

### 1. 上传参考图片

**方式一：点击上传**
- 点击上传区域
- 选择图片文件
- 支持多选

**方式二：拖拽上传**
- 将图片拖拽到上传区域
- 自动识别图片格式
- 批量上传

### 2. 编写提示词

在"编辑提示词"输入框中描述你想要的效果，例如：

#### 风格转换
```
将这张图片转换为油画风格，增强色彩饱和度
转换为水彩画风格，柔和的色调
赛博朋克风格，霓虹灯效果
卡通风格，简化细节
```

#### 图片增强
```
提升图片清晰度，增强细节
增强色彩，提高对比度
改善光线，使画面更明亮
去除噪点，平滑处理
```

#### 创意改造
```
改变背景为星空
添加雨天效果
将白天改为夜晚
添加复古滤镜
```

### 3. 设置参数

- **生成数量**：选择生成 1-4 张图片
- **输出格式**：Base64（默认）或 URL
- **流式输出**：开启后实时显示生成过程

### 4. 开始生成

点击"开始生成"按钮，等待 AI 处理：
- 非流式：等待所有图片生成完成后一次性显示
- 流式：实时显示生成过程，逐张展示

### 5. 查看和下载

- **预览**：点击图片查看大图
- **单张下载**：点击图片下方的"下载"按钮
- **批量下载**：点击右上角的"下载全部"按钮（自动打包为 ZIP）
- **清空结果**：点击右上角的"清空"按钮

## API 调用

### 端点

```
POST /v1/images/edits
```

### 请求格式

```bash
curl http://localhost:8000/v1/images/edits \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -F "prompt=将这张图片改成油画风格" \
  -F "image=@/path/to/image.jpg" \
  -F "model=grok-imagine-1.0-edit" \
  -F "n=2" \
  -F "response_format=b64_json"
```

### 参数说明

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `prompt` | string | ✅ | 编辑提示词 |
| `image` | file | ✅ | 参考图片文件（支持多张） |
| `model` | string | ✅ | 固定为 `grok-imagine-1.0-edit` |
| `n` | integer | ❌ | 生成数量（1-10），默认 1 |
| `response_format` | string | ❌ | 响应格式：`b64_json`、`url`，默认 `b64_json` |
| `stream` | boolean | ❌ | 是否流式输出，默认 `false` |

### 响应格式

**非流式响应**：
```json
{
  "created": 1234567890,
  "data": [
    {
      "b64_json": "base64_encoded_image_data"
    }
  ],
  "usage": {
    "total_tokens": 0,
    "input_tokens": 0,
    "output_tokens": 0
  }
}
```

**流式响应**：
```
data: {"data": [{"b64_json": "..."}]}

data: [DONE]
```

## Python 示例

```python
import requests

url = "http://localhost:8000/v1/images/edits"
headers = {"Authorization": "Bearer YOUR_API_KEY"}

# 上传图片
files = {
    "image": open("input.jpg", "rb")
}

# 设置参数
data = {
    "prompt": "将这张图片转换为油画风格",
    "model": "grok-imagine-1.0-edit",
    "n": 2,
    "response_format": "b64_json"
}

# 发送请求
response = requests.post(url, headers=headers, files=files, data=data)

# 处理结果
if response.status_code == 200:
    result = response.json()
    for i, item in enumerate(result["data"]):
        # 保存图片
        import base64
        image_data = base64.b64decode(item["b64_json"])
        with open(f"output_{i+1}.png", "wb") as f:
            f.write(image_data)
    print(f"成功生成 {len(result['data'])} 张图片")
else:
    print(f"生成失败: {response.text}")
```

## 提示词技巧

### 1. 明确描述效果
❌ 不好：`改一下这张图`
✅ 好：`将这张图片转换为油画风格，增强色彩饱和度，添加笔触效果`

### 2. 指定风格关键词
- **艺术风格**：油画、水彩、素描、版画、浮世绘
- **现代风格**：赛博朋克、蒸汽朋克、极简主义、波普艺术
- **摄影风格**：黑白、复古、胶片、HDR、长曝光

### 3. 描述具体调整
- **色彩**：增强饱和度、降低饱和度、暖色调、冷色调
- **光线**：增加亮度、柔和光线、戏剧性光影、逆光
- **细节**：提升清晰度、柔化处理、增强纹理、平滑皮肤

### 4. 组合多个效果
```
将这张图片转换为赛博朋克风格，
添加霓虹灯效果，
增强对比度，
使用紫色和蓝色色调，
营造未来感氛围
```

## 常见问题

### Q: 支持哪些图片格式？
A: 支持 PNG、JPEG、JPG、WebP 格式。

### Q: 单张图片最大多大？
A: 单张图片最大 50MB。

### Q: 最多可以上传多少张图片？
A: 最多可以上传 16 张参考图片。

### Q: 流式和非流式有什么区别？
A:
- **流式**：实时显示生成过程，逐张展示结果
- **非流式**：等待所有图片生成完成后一次性显示

### Q: 生成失败怎么办？
A:
1. 检查图片格式和大小是否符合要求
2. 确保提示词不为空
3. 检查网络连接
4. 查看浏览器控制台的错误信息

### Q: 如何提高生成质量？
A:
1. 使用高质量的参考图片
2. 编写详细、具体的提示词
3. 尝试不同的提示词组合
4. 增加生成数量，从中选择最佳结果

## 技术实现

### 前端
- **HTML**：页面结构和布局
- **CSS**：响应式设计和动画效果
- **JavaScript**：文件上传、API 调用、结果展示

### 后端
- **API 端点**：`/v1/images/edits`
- **模型**：`grok-imagine-1.0-edit`
- **处理流程**：
  1. 接收上传的图片文件
  2. 转换为 base64 编码
  3. 上传到 Grok 服务器
  4. 调用图片编辑模型
  5. 返回生成结果

### 文件结构
```
app/static/img2img/
├── img2img.html    # 页面结构
├── img2img.css     # 样式定义
└── img2img.js      # 交互逻辑
```

## 更新日志

### v1.0.0 (2026-02-08)
- ✅ 初始版本发布
- ✅ 支持图片上传和预览
- ✅ 支持流式和非流式生成
- ✅ 支持单张和批量下载
- ✅ 提供完整的使用说明

## 反馈与建议

如有问题或建议，请访问：
https://github.com/chenyme/grok2api/issues
