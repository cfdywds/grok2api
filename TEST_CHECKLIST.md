# 随机图片查看功能测试清单

## 🚀 启动前准备

### 1. 重启服务器
```bash
# 停止当前服务器（Ctrl+C）
python main.py
```

### 2. 确认图片数据
- 确保有已生成的图片在 `data/tmp/image/` 目录
- 确保图片已经过质量分析（quality_score >= 40）
- 如果没有，先进入"图片管理"页面点击"分析质量"

---

## ✅ 功能测试清单

### 一、页面访问测试

#### 1.1 通过导航栏访问
- [ ] 打开 `http://localhost:8000/admin`
- [ ] 点击顶部"服务管理"菜单
- [ ] 看到"随机查看"选项
- [ ] 点击"随机查看"
- [ ] 页面正常跳转到随机查看页面

#### 1.2 直接访问
- [ ] 在浏览器输入 `http://localhost:8000/admin/gallery/random`
- [ ] 页面正常加载

#### 1.3 页面布局检查
- [ ] 导航栏正常显示（白色背景）
- [ ] 导航栏固定在顶部
- [ ] "随机查看"链接高亮显示
- [ ] 页面没有滚动条
- [ ] 深色背景正常显示（#1a1a1a）
- [ ] 图片查看器占满整个屏幕（除导航栏外）

---

### 二、图片加载测试

#### 2.1 首次加载
- [ ] 页面显示"加载中..."状态
- [ ] 随机图片正常加载并显示
- [ ] 图片居中显示
- [ ] 图片不超出屏幕范围
- [ ] 图片清晰，没有 404 错误

#### 2.2 空状态测试
- [ ] 如果没有符合条件的图片，显示空状态
- [ ] 空状态显示图标和提示文字
- [ ] 显示"重新开始"按钮

---

### 三、导航功能测试

#### 3.1 鼠标点击导航
- [ ] 点击左侧区域 → 加载新的随机图片
- [ ] 点击右侧区域 → 加载新的随机图片
- [ ] 鼠标悬停在左右区域时显示导航提示
- [ ] 导航提示有淡入淡出动画

#### 3.2 键盘导航
- [ ] 按左方向键 → 加载新图片
- [ ] 按右方向键 → 加载新图片
- [ ] 连续按方向键，图片正常切换
- [ ] 不会重复显示已查看的图片

#### 3.3 触摸手势（移动端）
- [ ] 在移动设备或模拟器上打开页面
- [ ] 左滑 → 加载新图片
- [ ] 右滑 → 加载新图片
- [ ] 手势流畅，没有延迟

---

### 四、收藏功能测试

#### 4.1 收藏按钮
- [ ] 右上角显示爱心图标按钮
- [ ] 按钮为圆形，半透明黑色背景
- [ ] 鼠标悬停时按钮放大
- [ ] 初始状态为空心爱心（未收藏）

#### 4.2 收藏操作
- [ ] 点击爱心按钮 → 变为实心红色（已收藏）
- [ ] 显示 Toast 提示"已收藏"
- [ ] 再次点击 → 变回空心（取消收藏）
- [ ] 显示 Toast 提示"已取消收藏"

#### 4.3 快捷键收藏
- [ ] 按 F 键 → 切换收藏状态
- [ ] 显示相应的 Toast 提示
- [ ] 按钮状态正确更新

#### 4.4 收藏状态持久化
- [ ] 收藏一张图片
- [ ] 刷新页面（F5）
- [ ] 再次看到同一张图片时，收藏状态保持
- [ ] 在"图片管理"页面可以看到收藏标记

---

### 五、信息面板测试

#### 5.1 面板显示
- [ ] 底部显示信息面板
- [ ] 面板有半透明黑色背景
- [ ] 面板有模糊效果（backdrop-filter）
- [ ] 面板默认展开状态

#### 5.2 面板折叠
- [ ] 点击面板标题栏 → 面板折叠
- [ ] 折叠时只显示标题栏
- [ ] 箭头图标旋转 180 度
- [ ] 再次点击 → 面板展开
- [ ] 展开/折叠有平滑动画

#### 5.3 信息显示
- [ ] 提示词正确显示
- [ ] 质量评分正确显示
- [ ] 质量评分进度条颜色正确（绿/橙/红）
- [ ] 图片尺寸和宽高比正确显示
- [ ] 创建时间正确显示（本地时间格式）

---

### 六、操作按钮测试

#### 6.1 删除功能
- [ ] 点击"删除"按钮
- [ ] 显示确认对话框
- [ ] 点击"取消" → 不删除，对话框关闭
- [ ] 点击"确定" → 删除图片
- [ ] 显示 Toast 提示"删除成功"
- [ ] 自动加载下一张随机图片

#### 6.2 快捷键删除
- [ ] 按 Delete 键
- [ ] 显示确认对话框
- [ ] 确认后删除并加载下一张

#### 6.3 下载功能
- [ ] 点击"下载"按钮
- [ ] 浏览器开始下载图片
- [ ] 文件名正确（原始文件名）
- [ ] 显示 Toast 提示"开始下载"

---

### 七、Toast 通知测试

#### 7.1 通知显示
- [ ] Toast 从右侧滑入
- [ ] 显示在页面右上角
- [ ] 有滑入动画
- [ ] 3 秒后自动消失
- [ ] 消失时有滑出动画

#### 7.2 通知类型
- [ ] 成功通知：绿色左边框，勾选图标
- [ ] 错误通知：红色左边框，叉号图标
- [ ] 警告通知：橙色左边框，警告图标
- [ ] 信息通知：蓝色左边框，信息图标

#### 7.3 多个通知
- [ ] 快速触发多个操作
- [ ] 多个 Toast 垂直堆叠显示
- [ ] 每个 Toast 独立计时消失

---

### 八、加权随机算法测试

#### 8.1 权重验证
- [ ] 多次刷新页面，观察图片分布
- [ ] 高质量图片（score >= 80）出现频率更高
- [ ] 低质量图片（score < 60）出现频率较低
- [ ] 不会连续显示同一张图片

#### 8.2 排除机制
- [ ] 浏览 10 张图片
- [ ] 这 10 张图片都不重复
- [ ] 点击"重新开始"按钮
- [ ] 可以再次看到之前的图片

---

### 九、响应式设计测试

#### 9.1 桌面端（1920x1080）
- [ ] 图片最大宽度 90%
- [ ] 图片最大高度 85%
- [ ] 左右滑动区域各占 30% 宽度
- [ ] 收藏按钮大小 48x48px
- [ ] 信息面板最大高度 50%

#### 9.2 平板端（768x1024）
- [ ] 图片最大宽度 95%
- [ ] 图片最大高度 80%
- [ ] 左右滑动区域各占 40% 宽度
- [ ] 收藏按钮大小 40x40px
- [ ] 布局正常，没有溢出

#### 9.3 移动端（375x667）
- [ ] 图片适应屏幕
- [ ] 触摸滑动正常工作
- [ ] 按钮大小适中，易于点击
- [ ] Toast 通知宽度自适应
- [ ] 信息面板最大高度 60%

---

### 十、性能测试

#### 10.1 加载速度
- [ ] 首次加载时间 < 2 秒
- [ ] 切换图片响应时间 < 500ms
- [ ] 收藏操作响应时间 < 300ms
- [ ] 没有明显的卡顿

#### 10.2 内存占用
- [ ] 打开浏览器任务管理器
- [ ] 浏览 50 张图片
- [ ] 内存占用稳定，没有持续增长
- [ ] 没有内存泄漏

#### 10.3 网络请求
- [ ] 打开浏览器开发者工具（F12）
- [ ] 切换到 Network 标签
- [ ] 每次切换图片只有 1 个 API 请求
- [ ] 图片文件正确缓存
- [ ] 没有重复请求

---

### 十一、边界情况测试

#### 11.1 无图片情况
- [ ] 删除所有图片
- [ ] 访问随机查看页面
- [ ] 显示空状态
- [ ] 提示"没有符合条件的图片"

#### 11.2 所有图片已查看
- [ ] 浏览完所有图片
- [ ] 显示空状态
- [ ] 点击"重新开始"按钮
- [ ] 重置已查看列表，可以继续浏览

#### 11.3 网络错误
- [ ] 断开网络连接
- [ ] 尝试切换图片
- [ ] 显示错误 Toast 提示
- [ ] 恢复网络后功能正常

#### 11.4 API 错误
- [ ] 停止后端服务器
- [ ] 尝试切换图片
- [ ] 显示错误 Toast 提示
- [ ] 重启服务器后功能恢复

---

### 十二、浏览器兼容性测试

#### 12.1 Chrome/Edge（推荐）
- [ ] 所有功能正常
- [ ] 动画流畅
- [ ] 样式正确

#### 12.2 Firefox
- [ ] 所有功能正常
- [ ] 键盘快捷键正常
- [ ] 样式正确

#### 12.3 Safari（Mac/iOS）
- [ ] 所有功能正常
- [ ] 触摸手势正常
- [ ] backdrop-filter 效果正常

---

## 🐛 常见问题排查

### 问题 1：导航栏样式不对
**检查项：**
- [ ] 确认引入了 `/static/common/common.css`
- [ ] 确认引入了 `/static/common/header.js`
- [ ] 确认容器 ID 为 `app-header`
- [ ] 清除浏览器缓存（Ctrl+Shift+R）

### 问题 2：图片显示 404
**检查项：**
- [ ] 确认 `main.py` 中添加了图片目录挂载
- [ ] 确认图片文件存在于 `data/tmp/image/` 目录
- [ ] 检查文件路径是否正确
- [ ] 重启服务器

### 问题 3：API 返回 404
**检查项：**
- [ ] 确认路由顺序正确（/images/random 在 /images/{image_id} 之前）
- [ ] 检查 API 路径是否正确
- [ ] 查看服务器日志
- [ ] 重启服务器

### 问题 4：收藏状态不保存
**检查项：**
- [ ] 检查 `data/image_metadata.json` 文件权限
- [ ] 查看服务器日志是否有错误
- [ ] 确认 `toggle_favorite` 方法正常工作
- [ ] 检查并发锁是否正常

### 问题 5：页面显示"没有符合条件的图片"
**检查项：**
- [ ] 确认有图片文件
- [ ] 确认图片已分析质量（quality_score 不为 null）
- [ ] 确认质量分数 >= 40
- [ ] 在"图片管理"页面点击"分析质量"

---

## 📊 测试结果记录

### 测试环境
- 操作系统：__________
- 浏览器：__________
- 浏览器版本：__________
- 服务器版本：__________
- 测试日期：__________

### 测试结果统计
- 总测试项：120+
- 通过项：____
- 失败项：____
- 跳过项：____

### 发现的问题
1. ___________________________
2. ___________________________
3. ___________________________

### 测试结论
- [ ] 所有核心功能正常
- [ ] 可以发布使用
- [ ] 需要修复问题后再测试

---

## 📝 测试建议

1. **按顺序测试**：从上到下依次测试，确保基础功能正常后再测试高级功能
2. **记录问题**：发现问题时记录详细的复现步骤
3. **多次测试**：某些问题可能偶发，建议重复测试 2-3 次
4. **不同环境**：在不同浏览器和设备上测试
5. **性能监控**：使用浏览器开发者工具监控性能

---

测试完成后，请将结果反馈给开发团队。
