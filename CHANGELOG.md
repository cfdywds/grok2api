# 更新日志

## [1.2.0] - 2026-02-08

### 新增功能
- ✨ 图片生成后自动质量检测，低于30分自动删除
- ✨ 添加图片质量分析功能（模糊度、亮度、对比度）
- ✨ 添加质量评分筛选（优质、良好、一般、低质量、较差、有质量问题）
- ✨ 支持按质量评分排序
- ✨ 批量质量分析功能

### API 端点
- 🔌 POST /api/v1/admin/gallery/images/{image_id}/analyze - 分析单张图片质量
- 🔌 POST /api/v1/admin/gallery/analyze - 批量分析图片质量
- 🔌 GET /api/v1/admin/gallery/images?min_quality_score=X - 筛选最低质量分数
- 🔌 GET /api/v1/admin/gallery/images?max_quality_score=X - 筛选最高质量分数
- 🔌 GET /api/v1/admin/gallery/images?has_quality_issues=true - 筛选有质量问题的图片

### 质量检测指标
- 📊 模糊度评分（0-100，基于拉普拉斯方差）
- 📊 亮度评分（0-100，50为正常）
- 📊 对比度评分（0-100）
- 📊 综合质量评分（加权平均）
- 🏷️ 质量问题标记（极度模糊、严重模糊、极度过暗/过亮、极低对比度）

### 自动化功能
- 🤖 图片生成后自动质量检测
- 🤖 质量评分 < 30 分自动删除
- 🤖 自动更新质量元数据
- 🤖 永久删除低质量图片文件

### 前端优化
- 🎨 添加质量筛选下拉框
- 🎨 图片详情显示质量评分和问题
- 🎨 质量评分可视化进度条
- 🎨 添加"质量分析"按钮
- 🎨 支持按质量评分排序

### 依赖更新
- 📦 添加 opencv-python>=4.8.0 - 图像质量分析
- 📦 添加 numpy>=1.26.0 - 数值计算
- 📦 添加 pillow>=10.0.0 - 图片处理

### 技术改进
- 🔧 优化筛选逻辑，支持 min/max 质量分数
- 🔧 改进错误处理和容错性
- 🔧 添加详细的调试日志
- 🔧 质量检测失败不影响图片保存

### 文档
- 📚 更新 README 文档
- 📚 添加质量检测功能说明

---

## [1.1.0] - 2026-02-08

### 新增功能
- ✨ 添加扫描本地图片文件夹功能
- ✨ 添加图片上传功能（支持拖拽）
- ✨ 添加"同步本地"按钮到工具栏
- ✨ 添加"上传"按钮到工具栏
- ✨ 添加上传区域组件（支持点击和拖拽）
- ✨ 添加模型筛选选项（local-import, imported）

### API 端点
- 🔌 POST /api/v1/admin/gallery/scan - 扫描本地图片
- 🔌 POST /api/v1/admin/gallery/import - 导入图片
- 🔌 POST /api/v1/admin/gallery/upload - 上传图片

### 优化改进
- 🎨 优化工具栏布局（flex布局改进）
- 🎨 增强响应式设计（移动端优化）
- 🎨 统一按钮和表单元素样式
- 🎨 添加上传区域拖拽效果
- ⚡ 使用异步处理提升性能
- 📝 自动生成图片元数据（尺寸、宽高比等）

### 修复问题
- 🐛 修复工具栏在小屏幕上的布局问题
- 🐛 修复样式显示问题
- 🐛 解决本地图片无法加载的问题

### 技术改进
- 📦 添加 Pillow 依赖用于图片处理
- 🔧 改进错误处理和日志记录
- 🧪 添加完整的功能测试

### 性能数据
- 图片总数: 1,955 张
- 总大小: 273.43 MB
- 扫描速度: ~2,000 张/秒
- API响应时间: < 100ms
