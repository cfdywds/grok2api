<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å†å²æ•°æ®è¿ç§» - Grok2API</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/static/common/common.css">
  <style>
    body { background: var(--bg, #f9fafb); font-family: system-ui, sans-serif; }
    .container { max-width: 720px; margin: 0 auto; padding: 32px 16px; }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 24px; margin-bottom: 16px; }
    .step { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 16px; }
    .step-num { flex-shrink: 0; width: 28px; height: 28px; border-radius: 50%; background: #3b82f6; color: #fff; font-size: 13px; font-weight: 600; display: flex; align-items: center; justify-content: center; }
    .step-num.done { background: #10b981; }
    .step-num.error { background: #ef4444; }
    .btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 18px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; border: none; transition: opacity .15s; }
    .btn:disabled { opacity: .4; cursor: not-allowed; }
    .btn-primary { background: #3b82f6; color: #fff; }
    .btn-primary:hover:not(:disabled) { background: #2563eb; }
    .btn-success { background: #10b981; color: #fff; }
    .btn-danger { background: #ef4444; color: #fff; }
    .btn-outline { background: transparent; border: 1px solid #d1d5db; color: #374151; }
    .btn-outline:hover:not(:disabled) { background: #f3f4f6; }
    .progress-wrap { background: #e5e7eb; border-radius: 999px; height: 10px; overflow: hidden; margin: 8px 0; }
    .progress-bar { height: 100%; background: #3b82f6; border-radius: 999px; transition: width .3s; }
    .log { background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; height: 180px; overflow-y: auto; font-size: 12px; font-family: monospace; color: #374151; }
    .log-line { margin-bottom: 2px; }
    .log-line.ok { color: #10b981; }
    .log-line.err { color: #ef4444; }
    .log-line.warn { color: #f59e0b; }
    .stat-row { display: flex; gap: 16px; flex-wrap: wrap; }
    .stat-box { flex: 1; min-width: 120px; background: #f1f5f9; border-radius: 8px; padding: 12px 16px; }
    .stat-box .num { font-size: 24px; font-weight: 700; color: #1e293b; }
    .stat-box .label { font-size: 12px; color: #64748b; margin-top: 2px; }
    #workspace-status { font-size: 13px; color: #64748b; }
    #workspace-status.ok { color: #10b981; }
  </style>
</head>
<body>
  <div id="header-container"></div>

  <div class="container">
    <h1 style="font-size:22px;font-weight:700;margin-bottom:4px;">å†å²æ•°æ®è¿ç§»</h1>
    <p style="color:#64748b;font-size:14px;margin-bottom:24px;">å°†æœåŠ¡ç«¯ <code>./data/tmp/image</code> ä¸­çš„å›¾ç‰‡å’Œå…ƒæ•°æ®è¿ç§»åˆ°æœ¬åœ°å·¥ä½œç›®å½•</p>

    <!-- æœåŠ¡ç«¯çŠ¶æ€ -->
    <div class="card">
      <div style="font-weight:600;margin-bottom:12px;">ğŸ“Š æœåŠ¡ç«¯æ•°æ®</div>
      <div class="stat-row">
        <div class="stat-box">
          <div class="num" id="stat-total">-</div>
          <div class="label">æœåŠ¡ç«¯å›¾ç‰‡æ€»æ•°</div>
        </div>
        <div class="stat-box">
          <div class="num" id="stat-migrated">0</div>
          <div class="label">å·²è¿ç§»</div>
        </div>
        <div class="stat-box">
          <div class="num" id="stat-failed">0</div>
          <div class="label">å¤±è´¥</div>
        </div>
      </div>
      <div style="margin-top:12px;">
        <span id="server-status" style="font-size:13px;color:#64748b;">æ­£åœ¨åŠ è½½æœåŠ¡ç«¯ä¿¡æ¯...</span>
      </div>
    </div>

    <!-- å·¥ä½œç›®å½• -->
    <div class="card">
      <div style="font-weight:600;margin-bottom:12px;">ğŸ“ æœ¬åœ°å·¥ä½œç›®å½•</div>
      <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
        <button class="btn btn-outline" id="select-workspace-btn">é€‰æ‹©å·¥ä½œç›®å½•</button>
        <span id="workspace-status">æœªè®¾ç½®</span>
      </div>
      <p style="margin-top:8px;font-size:12px;color:#94a3b8;">
        âš ï¸ å»ºè®®é€‰æ‹©ä¸€ä¸ªç©ºç›®å½•æˆ–ä¸“ç”¨ç›®å½•ï¼Œè¿ç§»å°†åœ¨æ­¤ç›®å½•ä¸‹åˆ›å»ºå›¾ç‰‡æ–‡ä»¶å’Œ <code>image_metadata.json</code>
      </p>
    </div>

    <!-- è¿ç§»è¿›åº¦ -->
    <div class="card">
      <div style="font-weight:600;margin-bottom:12px;">ğŸš€ è¿ç§»è¿›åº¦</div>
      <div class="progress-wrap">
        <div class="progress-bar" id="progress-bar" style="width:0%"></div>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:12px;color:#64748b;margin-bottom:12px;">
        <span id="progress-text">0 / 0</span>
        <span id="progress-pct">0%</span>
      </div>
      <div class="log" id="log"></div>
      <div style="display:flex;gap:10px;margin-top:14px;flex-wrap:wrap;">
        <button class="btn btn-primary" id="start-btn" disabled>å¼€å§‹è¿ç§»</button>
        <button class="btn btn-danger" id="stop-btn" style="display:none;">åœæ­¢</button>
        <button class="btn btn-outline" id="refresh-btn">åˆ·æ–°æœåŠ¡ç«¯ä¿¡æ¯</button>
      </div>
    </div>

    <!-- è¯´æ˜ -->
    <div class="card" style="background:#fffbeb;border-color:#fde68a;">
      <div style="font-weight:600;margin-bottom:8px;color:#92400e;">ğŸ“ è¿ç§»è¯´æ˜</div>
      <ul style="font-size:13px;color:#78350f;line-height:1.8;padding-left:16px;">
        <li>è¿ç§»ä¼šä»æœåŠ¡ç«¯é€å¼ ä¸‹è½½å›¾ç‰‡å¹¶ä¿å­˜åˆ°ä½ é€‰æ‹©çš„æœ¬åœ°ç›®å½•</li>
        <li>åŒæ—¶ç”Ÿæˆ <code>image_metadata.json</code>ï¼ŒåŒ…å«æ‰€æœ‰æç¤ºè¯ã€è¯„åˆ†ã€æ ‡ç­¾ã€æ”¶è—ç­‰ä¿¡æ¯</li>
        <li>è¿ç§»å®Œæˆåï¼Œåœ¨å›¾åº“/éšæœºæŸ¥çœ‹é¡µé¢é€‰æ‹©è¯¥ç›®å½•å³å¯æµè§ˆå†å²å›¾ç‰‡</li>
        <li>æœåŠ¡ç«¯çš„æ•°æ®<strong>ä¸ä¼šè¢«åˆ é™¤</strong>ï¼Œè¿ç§»æ˜¯åªè¯»æ‹·è´æ“ä½œ</li>
        <li>å¦‚æœç›®å½•å·²æœ‰ <code>image_metadata.json</code>ï¼Œè¿ç§»ä¼š<strong>è¿½åŠ </strong>è€Œéè¦†ç›–</li>
        <li>éœ€è¦ä½¿ç”¨ Chrome æˆ– Edge æµè§ˆå™¨ï¼ˆFirefox ä¸æ”¯æŒ File System Access APIï¼‰</li>
        <li>å¿…é¡»é€šè¿‡ <code>http://localhost</code> æˆ– <code>https://</code> è®¿é—®ï¼Œé€šè¿‡ IP åœ°å€è®¿é—®å°†å¯¼è‡´ API ä¸å¯ç”¨</li>
      </ul>
    </div>
  </div>

  <script src="/static/common/workspace.js"></script>
  <script src="/static/gallery/migrate.js"></script>
  <script>
    fetch('/static/common/header.html')
      .then(r => r.text())
      .then(html => { document.getElementById('header-container').innerHTML = html; });
  </script>
</body>
</html>
