<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片管理 - Grok2API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/common/common.css">
    <link rel="stylesheet" href="/static/gallery/gallery.css">
</head>
<body>
    <div id="app">
        <!-- Toast 通知容器 -->
        <div id="toast-container" class="toast-container"></div>

        <!-- 导航栏 -->
        <div id="header-container"></div>

        <!-- 主容器 -->
        <div class="container">
            <!-- 统计卡片 -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon">📊</div>
                    <div class="stat-content">
                        <div class="stat-label">图片总数</div>
                        <div class="stat-value" id="stat-total">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">💾</div>
                    <div class="stat-content">
                        <div class="stat-label">总大小</div>
                        <div class="stat-value" id="stat-size">0 MB</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📅</div>
                    <div class="stat-content">
                        <div class="stat-label">本月新增</div>
                        <div class="stat-value" id="stat-month">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🏷️</div>
                    <div class="stat-content">
                        <div class="stat-label">常用标签</div>
                        <div class="stat-value" id="stat-tags">-</div>
                    </div>
                </div>
            </div>

            <!-- 筛选工具栏 -->
            <div class="toolbar">
                <div class="toolbar-left">
                    <input type="text" id="search-input" class="search-input" placeholder="搜索提示词...">
                    <select id="model-filter" class="filter-select">
                        <option value="">所有模型</option>
                        <option value="grok-imagine-1.0">grok-imagine-1.0</option>
                        <option value="local-import">本地导入</option>
                        <option value="imported">手动导入</option>
                    </select>
                    <select id="ratio-filter" class="filter-select">
                        <option value="">所有比例</option>
                        <option value="1:1">1:1</option>
                        <option value="2:3">2:3</option>
                        <option value="3:2">3:2</option>
                        <option value="9:16">9:16</option>
                        <option value="16:9">16:9</option>
                    </select>
                    <select id="sort-filter" class="filter-select">
                        <option value="created_at:desc">最新优先</option>
                        <option value="created_at:asc">最早优先</option>
                        <option value="file_size:desc">大小降序</option>
                        <option value="file_size:asc">大小升序</option>
                        <option value="quality_score:desc">质量降序</option>
                        <option value="quality_score:asc">质量升序</option>
                    </select>
                    <select id="quality-filter" class="filter-select">
                        <option value="">所有质量</option>
                        <option value="80">优质 (≥80分)</option>
                        <option value="60">良好 (≥60分)</option>
                        <option value="40">一般 (≥40分)</option>
                        <option value="low40">低质量 (<40分)</option>
                        <option value="low">较差 (<60分)</option>
                        <option value="issues">有质量问题</option>
                    </select>
                    <select id="page-size-filter" class="filter-select" title="每页显示数量">
                        <option value="20">20/页</option>
                        <option value="50" selected>50/页</option>
                        <option value="100">100/页</option>
                        <option value="200">200/页</option>
                    </select>
                    <button id="filter-btn" class="btn btn-primary">筛选</button>
                    <button id="reset-btn" class="btn btn-secondary">重置</button>
                </div>
                <div class="toolbar-right">
                    <button id="analyze-btn" class="btn btn-warning" title="分析图片质量">
                        <span>🔍</span> 质量分析
                    </button>
                    <button id="stop-analysis-btn" class="btn btn-danger" title="停止分析" style="display: none;">
                        <span>⏹</span> 停止分析
                    </button>
                    <button id="analyze-options-btn" class="btn btn-secondary" title="配置分析选项">
                        <span>⚙️</span> 分析选项
                    </button>
                    <button id="scan-btn" class="btn btn-primary" title="扫描本地图片文件夹">
                        <span>🔄</span> 同步本地
                    </button>
                    <button id="upload-btn" class="btn btn-primary" title="上传图片">
                        <span>📤</span> 上传
                    </button>
                    <button id="view-grid" class="btn btn-icon active" title="网格视图">
                        <span>⊞</span>
                    </button>
                    <button id="view-list" class="btn btn-icon" title="列表视图">
                        <span>☰</span>
                    </button>
                    <button id="select-all" class="btn btn-secondary">全选</button>
                    <button id="export-btn" class="btn btn-primary" disabled>导出</button>
                    <button id="delete-btn" class="btn btn-danger" disabled>删除</button>
                </div>
            </div>

            <!-- 上传区域 -->
            <div class="upload-area" id="upload-area">
                <div class="upload-dropzone" id="upload-dropzone">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">点击或拖拽图片到此处上传</div>
                    <div class="upload-hint">支持 JPG、PNG、WebP、GIF 格式</div>
                    <input type="file" id="file-input" accept="image/*" multiple style="display: none;">
                </div>
            </div>

            <!-- 顶部分页 -->
            <div class="pagination pagination-top" id="pagination-top" style="display: none;">
                <button id="prev-page-top" class="btn btn-secondary" disabled>上一页</button>
                <span id="page-info-top">第 1 页 / 共 1 页</span>
                <button id="next-page-top" class="btn btn-secondary" disabled>下一页</button>
            </div>

            <!-- 图片容器 -->
            <div id="images-container" class="images-grid">
                <!-- 图片将通过 JavaScript 动态加载 -->
            </div>

            <!-- 加载状态 -->
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>加载中...</p>
            </div>

            <!-- 空状态 -->
            <div id="empty-state" class="empty-state" style="display: none;">
                <div class="empty-icon">🖼️</div>
                <p>暂无图片</p>
            </div>

            <!-- 底部分页 -->
            <div class="pagination" id="pagination" style="display: none;">
                <button id="prev-page" class="btn btn-secondary" disabled>上一页</button>
                <span id="page-info">第 1 页 / 共 1 页</span>
                <button id="next-page" class="btn btn-secondary" disabled>下一页</button>
            </div>
        </div>

        <!-- 分析选项弹窗 -->
        <div id="analysis-options-modal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 500px;">
                <span class="modal-close" id="close-analysis-options">&times;</span>
                <div class="modal-body">
                    <h3>图片质量分析选项</h3>

                    <!-- 分析模式 -->
                    <div class="option-group">
                        <label class="option-label">分析模式：</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="analysis-mode" value="all" checked>
                                <span>
                                    <strong>全量分析</strong>
                                    <small>分析所有图片（包括已分析过的）</small>
                                </span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="analysis-mode" value="skip">
                                <span>
                                    <strong>增量分析</strong>
                                    <small>仅分析未分析过的图片</small>
                                </span>
                            </label>
                        </div>
                    </div>

                    <!-- 并发数 -->
                    <div class="option-group">
                        <label class="option-label">
                            并发线程数：<span id="worker-count-display" class="value-display">8</span>
                        </label>
                        <input type="range" id="worker-count-slider"
                               min="4" max="16" value="8" step="4" class="slider">
                        <div class="slider-labels">
                            <span>4（较慢，低资源）</span>
                            <span>16（较快，高资源）</span>
                        </div>
                    </div>

                    <!-- 预估时间 -->
                    <div class="option-group">
                        <label class="option-label">预计耗时：</label>
                        <div id="estimated-time" class="value-display">计算中...</div>
                        <div class="help-text">基于当前选择的模式和并发数估算</div>
                    </div>

                    <!-- 操作按钮 -->
                    <div class="modal-actions">
                        <button id="start-analysis-btn" class="btn btn-primary">开始分析</button>
                        <button id="cancel-analysis-options-btn" class="btn btn-secondary">取消</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 图片详情弹窗 -->
        <div id="detail-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="modal-close" id="close-detail-modal">&times;</span>
                <!-- 导航按钮 -->
                <button id="prev-image-btn" class="modal-nav-btn modal-nav-prev" title="上一张">
                    <span>‹</span>
                </button>
                <button id="next-image-btn" class="modal-nav-btn modal-nav-next" title="下一张">
                    <span>›</span>
                </button>
                <div class="modal-body">
                    <div class="modal-image">
                        <img id="detail-image" src="" alt="图片">
                    </div>
                    <div class="modal-info">
                        <h3>图片详情</h3>
                        <div class="info-group">
                            <label>提示词：</label>
                            <p id="detail-prompt"></p>
                        </div>
                        <div class="info-group">
                            <label>模型：</label>
                            <p id="detail-model"></p>
                        </div>
                        <div class="info-group">
                            <label>宽高比：</label>
                            <p id="detail-ratio"></p>
                        </div>
                        <div class="info-group">
                            <label>尺寸：</label>
                            <p id="detail-size"></p>
                        </div>
                        <div class="info-group">
                            <label>文件大小：</label>
                            <p id="detail-filesize"></p>
                        </div>
                        <div class="info-group">
                            <label>创建时间：</label>
                            <p id="detail-time"></p>
                        </div>
                        <div class="info-group">
                            <label>文件位置：</label>
                            <div class="file-path-container">
                                <input type="text" id="detail-file-path" readonly class="file-path-input">
                                <button id="copy-path-btn" class="btn-icon" title="复制路径">
                                    <span>📋</span>
                                </button>
                            </div>
                        </div>
                        <div class="info-group" id="quality-info" style="display: none;">
                            <label>质量评分：</label>
                            <div class="quality-info">
                                <div class="quality-score-bar">
                                    <div class="quality-score-fill" id="detail-quality-fill"></div>
                                    <span class="quality-score-text" id="detail-quality-score">-</span>
                                </div>
                                <div class="quality-details">
                                    <span id="detail-blur">模糊度: -</span>
                                    <span id="detail-brightness">亮度: -</span>
                                </div>
                                <div class="quality-issues" id="detail-quality-issues"></div>
                            </div>
                        </div>
                        <div class="info-group">
                            <label>标签：</label>
                            <div id="detail-tags" class="tags-container"></div>
                        </div>
                        <div class="info-group">
                            <label>添加标签：</label>
                            <div class="tag-input-group">
                                <input type="text" id="tag-input" placeholder="输入标签，按回车添加">
                                <button id="add-tag-btn" class="btn btn-primary btn-sm">添加</button>
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button id="download-btn" class="btn btn-primary">下载</button>
                            <button id="delete-single-btn" class="btn btn-danger">删除</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/gallery/gallery.js?v=1.2.1"></script>
    <script>
        // 加载导航栏
        fetch('/static/common/header.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('header-container').innerHTML = html;
            });
    </script>
</body>
</html>
