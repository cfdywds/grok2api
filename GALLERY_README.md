# å›¾ç‰‡ç®¡ç†åŠŸèƒ½ (Image Gallery Management)

<div align="center">

![Status](https://img.shields.io/badge/status-completed-success)
![Test Coverage](https://img.shields.io/badge/tests-96.7%25-brightgreen)
![Code Lines](https://img.shields.io/badge/code-5268%20lines-blue)
![Version](https://img.shields.io/badge/version-1.0.0-orange)

**å®Œæ•´çš„å›¾ç‰‡ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒæµè§ˆã€ç­›é€‰ã€æ‰¹é‡æ“ä½œå’Œæ ‡ç­¾ç®¡ç†**

[å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§) â€¢ [API æ–‡æ¡£](#-api-æ–‡æ¡£) â€¢ [æ¼”ç¤º](#-æ¼”ç¤º) â€¢ [æ–‡æ¡£](#-æ–‡æ¡£)

</div>

---

## ğŸ“– ç›®å½•

- [æ¦‚è¿°](#-æ¦‚è¿°)
- [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [ç•Œé¢é¢„è§ˆ](#-ç•Œé¢é¢„è§ˆ)
- [API æ–‡æ¡£](#-api-æ–‡æ¡£)
- [æ¶æ„è®¾è®¡](#-æ¶æ„è®¾è®¡)
- [é…ç½®é€‰é¡¹](#-é…ç½®é€‰é¡¹)
- [æµ‹è¯•](#-æµ‹è¯•)
- [æ–‡æ¡£](#-æ–‡æ¡£)
- [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)
- [è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)

---

## ğŸ¯ æ¦‚è¿°

å›¾ç‰‡ç®¡ç†åŠŸèƒ½æ˜¯ Grok2API çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œä¸ºç”¨æˆ·æä¾›å®Œæ•´çš„å›¾ç‰‡ç”Ÿå‘½å‘¨æœŸç®¡ç†èƒ½åŠ›ã€‚

### æ ¸å¿ƒä»·å€¼

- ğŸ¨ **è‡ªåŠ¨åŒ–ç®¡ç†**: å›¾ç‰‡ç”Ÿæˆæ—¶è‡ªåŠ¨ä¿å­˜å…ƒæ•°æ®ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
- ğŸ” **å¼ºå¤§ç­›é€‰**: æ”¯æŒå¤šç»´åº¦ç­›é€‰å’Œæ’åºï¼Œå¿«é€Ÿæ‰¾åˆ°ç›®æ ‡å›¾ç‰‡
- ğŸ“¦ **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡å¯¼å‡ºå’Œåˆ é™¤ï¼Œæé«˜ç®¡ç†æ•ˆç‡
- ğŸ·ï¸ **æ ‡ç­¾ç³»ç»Ÿ**: çµæ´»çš„æ ‡ç­¾ç®¡ç†ï¼Œä¾¿äºåˆ†ç±»å’Œæ£€ç´¢
- ğŸ“Š **ç»Ÿè®¡åˆ†æ**: å®æ—¶ç»Ÿè®¡ä¿¡æ¯ï¼Œäº†è§£å›¾ç‰‡ä½¿ç”¨æƒ…å†µ
- ğŸ“± **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯ï¼Œéšæ—¶éšåœ°ç®¡ç†

### æŠ€æœ¯äº®ç‚¹

- âš¡ **å¼‚æ­¥å¤„ç†**: å…ƒæ•°æ®ä¿å­˜ä¸é˜»å¡å›¾ç‰‡ç”Ÿæˆ
- ğŸ”„ **æ•°æ®ä¸€è‡´æ€§**: æ–‡ä»¶å’Œå…ƒæ•°æ®è‡ªåŠ¨åŒæ­¥
- ğŸ—„ï¸ **å­˜å‚¨æŠ½è±¡**: æ”¯æŒ Local/Redis/SQL å¤šç§å­˜å‚¨åç«¯
- ğŸ¯ **é«˜æ€§èƒ½**: åˆ†é¡µåŠ è½½ã€ç´¢å¼•ä¼˜åŒ–
- ğŸ§ª **é«˜æµ‹è¯•è¦†ç›–**: 96.7% æµ‹è¯•é€šè¿‡ç‡

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### 1. å…ƒæ•°æ®ç®¡ç†

<table>
<tr>
<td width="50%">

**è‡ªåŠ¨ä¿å­˜**
- âœ… å›¾ç‰‡ç”Ÿæˆæ—¶è‡ªåŠ¨ä¿å­˜å…ƒæ•°æ®
- âœ… åŒ…å«æç¤ºè¯ã€æ¨¡å‹ã€æ—¶é—´ç­‰ä¿¡æ¯
- âœ… å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡å“åº”

</td>
<td width="50%">

**æ•°æ®åŒæ­¥**
- âœ… æ–‡ä»¶åˆ é™¤æ—¶åŒæ­¥åˆ é™¤å…ƒæ•°æ®
- âœ… ç¼“å­˜æ¸…ç©ºæ—¶åŒæ­¥æ¸…ç©ºå…ƒæ•°æ®
- âœ… æ”¯æŒå­¤ç«‹å…ƒæ•°æ®æ¸…ç†

</td>
</tr>
</table>

### 2. å›¾ç‰‡æµè§ˆ

<table>
<tr>
<td width="50%">

**ç½‘æ ¼è§†å›¾**
- âœ… å¡ç‰‡å¼å±•ç¤º
- âœ… æ‚¬åœæ•ˆæœ
- âœ… æ˜¾ç¤ºç¼©ç•¥å›¾å’ŒåŸºæœ¬ä¿¡æ¯

</td>
<td width="50%">

**åˆ—è¡¨è§†å›¾**
- âœ… è¡¨æ ¼å¼å±•ç¤º
- âœ… æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
- âœ… ç´§å‡‘å¸ƒå±€

</td>
</tr>
</table>

### 3. ç­›é€‰å’Œæ’åº

| ç­›é€‰ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| ğŸ” å…³é”®è¯æœç´¢ | æŒ‰æç¤ºè¯æœç´¢ | "sunset", "ocean" |
| ğŸ¤– æ¨¡å‹ç­›é€‰ | æŒ‰ç”Ÿæˆæ¨¡å‹ç­›é€‰ | grok-imagine-1.0 |
| ğŸ“ å®½é«˜æ¯”ç­›é€‰ | æŒ‰å›¾ç‰‡æ¯”ä¾‹ç­›é€‰ | 1:1, 2:3, 16:9 |
| ğŸ”¢ æ’åº | å¤šç§æ’åºæ–¹å¼ | æ—¶é—´ã€å¤§å°ï¼ˆå‡åº/é™åºï¼‰ |
| ğŸ“„ åˆ†é¡µ | åˆ†é¡µåŠ è½½ | æ¯é¡µ 50 å¼  |

### 4. æ‰¹é‡æ“ä½œ

```
é€‰æ‹©å›¾ç‰‡ â†’ æ‰¹é‡æ“ä½œ
   â”œâ”€ ğŸ“¦ æ‰¹é‡å¯¼å‡º (ZIP)
   â”œâ”€ ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤
   â””â”€ âœ… å…¨é€‰/å–æ¶ˆå…¨é€‰
```

### 5. æ ‡ç­¾ç®¡ç†

- âœ… æ·»åŠ æ ‡ç­¾
- âœ… åˆ é™¤æ ‡ç­¾
- âœ… æ ‡ç­¾ç»Ÿè®¡
- âœ… æ ‡ç­¾å±•ç¤º

### 6. ç»Ÿè®¡ä¿¡æ¯

<table>
<tr>
<td align="center" width="25%">
<h3>ğŸ“Š</h3>
<b>å›¾ç‰‡æ€»æ•°</b><br>
å®æ—¶ç»Ÿè®¡
</td>
<td align="center" width="25%">
<h3>ğŸ’¾</h3>
<b>æ€»æ–‡ä»¶å¤§å°</b><br>
å­˜å‚¨å ç”¨
</td>
<td align="center" width="25%">
<h3>ğŸ“…</h3>
<b>æœ¬æœˆæ–°å¢</b><br>
æœˆåº¦ç»Ÿè®¡
</td>
<td align="center" width="25%">
<h3>ğŸ·ï¸</h3>
<b>å¸¸ç”¨æ ‡ç­¾</b><br>
TOP 3
</td>
</tr>
</table>

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.8+
- FastAPI
- å·²å®‰è£…ä¾èµ–: `orjson`, `aiofiles`, `loguru`, `pydantic`

### å®‰è£…æ­¥éª¤

```bash
# 1. å…‹éš†ä»“åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone https://github.com/chenyme/grok2api.git
cd grok2api

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. å¯åŠ¨æœåŠ¡
python main.py
```

### è®¿é—®é¡µé¢

```
http://localhost:8000/admin/gallery
```

### ç”Ÿæˆç¬¬ä¸€å¼ å›¾ç‰‡

**æ–¹å¼ 1: ä½¿ç”¨ API**

```bash
curl -X POST http://localhost:8000/v1/images/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "prompt": "a beautiful sunset over the ocean",
    "model": "grok-imagine-1.0",
    "n": 1
  }'
```

**æ–¹å¼ 2: ä½¿ç”¨ Imagine é¡µé¢**

è®¿é—® `http://localhost:8000/admin/imagine` ä½¿ç”¨å®æ—¶å›¾ç‰‡ç”ŸæˆåŠŸèƒ½ã€‚

### æŸ¥çœ‹ç®¡ç†é¡µé¢

å›¾ç‰‡ç”Ÿæˆåï¼Œè®¿é—®å›¾ç‰‡ç®¡ç†é¡µé¢å³å¯çœ‹åˆ°ï¼š
- âœ… å›¾ç‰‡ç¼©ç•¥å›¾
- âœ… æç¤ºè¯ä¿¡æ¯
- âœ… å…ƒæ•°æ®è¯¦æƒ…
- âœ… ç»Ÿè®¡ä¿¡æ¯

---

## ğŸ–¼ï¸ ç•Œé¢é¢„è§ˆ

### ä¸»é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Grok2API                              [æœåŠ¡ç®¡ç† â–¼]        â”‚
â”‚                                        â””â”€ å›¾ç‰‡ç®¡ç†          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š å›¾ç‰‡æ€»æ•°: 42    ğŸ’¾ æ€»å¤§å°: 125 MB                      â”‚
â”‚  ğŸ“… æœ¬æœˆæ–°å¢: 15    ğŸ·ï¸ å¸¸ç”¨æ ‡ç­¾: sunset, ocean, nature   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æœç´¢æ¡†] [æ¨¡å‹â–¼] [æ¯”ä¾‹â–¼] [æ’åºâ–¼] [ç­›é€‰] [é‡ç½®]          â”‚
â”‚  [âŠç½‘æ ¼] [â˜°åˆ—è¡¨] [å…¨é€‰] [å¯¼å‡º] [åˆ é™¤]                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ â˜‘ï¸   â”‚ â”‚ â˜   â”‚ â”‚ â˜   â”‚ â”‚ â˜   â”‚                      â”‚
â”‚  â”‚[å›¾ç‰‡]â”‚ â”‚[å›¾ç‰‡]â”‚ â”‚[å›¾ç‰‡]â”‚ â”‚[å›¾ç‰‡]â”‚                      â”‚
â”‚  â”‚æç¤ºè¯â”‚ â”‚æç¤ºè¯â”‚ â”‚æç¤ºè¯â”‚ â”‚æç¤ºè¯â”‚                      â”‚
â”‚  â”‚1:1 2Mâ”‚ â”‚2:3 3Mâ”‚ â”‚1:1 2Mâ”‚ â”‚16:9 4Mâ”‚                     â”‚
â”‚  â”‚[æ ‡ç­¾]â”‚ â”‚[æ ‡ç­¾]â”‚ â”‚[æ ‡ç­¾]â”‚ â”‚[æ ‡ç­¾]â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                             â”‚
â”‚  [ä¸Šä¸€é¡µ]  ç¬¬ 1 é¡µ / å…± 3 é¡µ  [ä¸‹ä¸€é¡µ]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦æƒ…å¼¹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å›¾ç‰‡è¯¦æƒ…                                            [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚  æç¤ºè¯: a beautiful sunset...       â”‚
â”‚                     â”‚  æ¨¡å‹: grok-imagine-1.0              â”‚
â”‚    [å¤§å›¾æ˜¾ç¤º]       â”‚  å®½é«˜æ¯”: 1:1                         â”‚
â”‚                     â”‚  å°ºå¯¸: 1024 Ã— 1024                   â”‚
â”‚                     â”‚  æ–‡ä»¶å¤§å°: 2.5 MB                    â”‚
â”‚                     â”‚  åˆ›å»ºæ—¶é—´: 2026-02-07 23:00          â”‚
â”‚                     â”‚  æ ‡ç­¾: [sunset] [ocean] [Ã—]          â”‚
â”‚                     â”‚  æ·»åŠ æ ‡ç­¾: [è¾“å…¥æ¡†] [æ·»åŠ ]           â”‚
â”‚                     â”‚  [ä¸‹è½½] [åˆ é™¤]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ API æ–‡æ¡£

### ç«¯ç‚¹åˆ—è¡¨

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/api/v1/admin/gallery/images` | GET | è·å–å›¾ç‰‡åˆ—è¡¨ | å¦ |
| `/api/v1/admin/gallery/images/{id}` | GET | è·å–å›¾ç‰‡è¯¦æƒ… | å¦ |
| `/api/v1/admin/gallery/images/delete` | POST | æ‰¹é‡åˆ é™¤å›¾ç‰‡ | å¦ |
| `/api/v1/admin/gallery/images/{id}/tags` | POST | æ›´æ–°å›¾ç‰‡æ ‡ç­¾ | å¦ |
| `/api/v1/admin/gallery/tags` | GET | è·å–æ‰€æœ‰æ ‡ç­¾ | å¦ |
| `/api/v1/admin/gallery/stats` | GET | è·å–ç»Ÿè®¡ä¿¡æ¯ | å¦ |
| `/api/v1/admin/gallery/images/export` | POST | æ‰¹é‡å¯¼å‡ºå›¾ç‰‡ | å¦ |

### è¯¦ç»†è¯´æ˜

#### 1. è·å–å›¾ç‰‡åˆ—è¡¨

```http
GET /api/v1/admin/gallery/images
```

**æŸ¥è¯¢å‚æ•°**:
- `page` (int): é¡µç ï¼Œé»˜è®¤ 1
- `page_size` (int): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 50
- `search` (string): æœç´¢å…³é”®è¯
- `model` (string): æ¨¡å‹ç­›é€‰
- `aspect_ratio` (string): å®½é«˜æ¯”ç­›é€‰
- `sort_by` (string): æ’åºå­—æ®µï¼Œé»˜è®¤ `created_at`
- `sort_order` (string): æ’åºé¡ºåºï¼Œ`asc` æˆ– `desc`

**å“åº”ç¤ºä¾‹**:
```json
{
  "images": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "filename": "550e8400-e29b-41d4-a716-446655440000.jpg",
      "prompt": "a beautiful sunset over the ocean",
      "model": "grok-imagine-1.0",
      "aspect_ratio": "1:1",
      "created_at": 1707321600000,
      "file_size": 245678,
      "width": 1024,
      "height": 1024,
      "tags": ["sunset", "ocean"],
      "nsfw": false,
      "metadata": {}
    }
  ],
  "total": 42,
  "page": 1,
  "page_size": 50,
  "total_pages": 1
}
```

#### 2. æ‰¹é‡åˆ é™¤å›¾ç‰‡

```http
POST /api/v1/admin/gallery/images/delete
Content-Type: application/json
```

**è¯·æ±‚ä½“**:
```json
{
  "image_ids": ["uuid1", "uuid2", "uuid3"]
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "åˆ é™¤å®Œæˆ: æˆåŠŸ 3, å¤±è´¥ 0",
  "data": {
    "deleted": 3,
    "failed": 0,
    "total": 3
  }
}
```

#### 3. æ›´æ–°å›¾ç‰‡æ ‡ç­¾

```http
POST /api/v1/admin/gallery/images/{image_id}/tags
Content-Type: application/json
```

**è¯·æ±‚ä½“**:
```json
{
  "tags": ["sunset", "ocean", "nature"]
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æ ‡ç­¾æ›´æ–°æˆåŠŸ"
}
```

#### 4. è·å–ç»Ÿè®¡ä¿¡æ¯

```http
GET /api/v1/admin/gallery/stats
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "total_count": 42,
  "total_size": 131072000,
  "month_count": 15,
  "top_tags": [
    {"name": "sunset", "count": 12},
    {"name": "ocean", "count": 8},
    {"name": "nature", "count": 6}
  ],
  "models": {
    "grok-imagine-1.0": 42
  },
  "aspect_ratios": {
    "1:1": 20,
    "2:3": 12,
    "16:9": 10
  }
}
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend (Browser)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ gallery.html â”‚  â”‚ gallery.css  â”‚  â”‚ gallery.js   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP/REST API
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (FastAPI)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              API Layer (gallery.py)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Service Layer (service.py)                â”‚  â”‚
â”‚  â”‚  - ImageMetadataService                           â”‚  â”‚
â”‚  â”‚  - add_image(), get_image(), list_images()        â”‚  â”‚
â”‚  â”‚  - delete_images(), update_tags(), get_stats()    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Storage Layer (storage.py)                â”‚  â”‚
â”‚  â”‚  - BaseStorage (Abstract)                         â”‚  â”‚
â”‚  â”‚  - LocalStorage, RedisStorage, SQLStorage         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Storage                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Local Files  â”‚  â”‚    Redis     â”‚  â”‚  MySQL/PgSQL â”‚  â”‚
â”‚  â”‚ (JSON)       â”‚  â”‚              â”‚  â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
å›¾ç‰‡ç”Ÿæˆ â†’ ä¿å­˜å…ƒæ•°æ® â†’ å­˜å‚¨æœåŠ¡ â†’ æ•°æ®åº“
    â†“
å›¾ç‰‡æ–‡ä»¶ â†’ data/tmp/image/
    â†“
å…ƒæ•°æ® â†’ data/image_metadata.json (æˆ– Redis/SQL)
```

### ç›®å½•ç»“æ„

```
grok2api/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ gallery.py          # Gallery API è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ image.py            # å›¾ç‰‡ç”Ÿæˆ API (é›†æˆ)
â”‚   â”‚       â””â”€â”€ admin.py            # ç®¡ç†é¡µé¢ (é›†æˆ)
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ gallery/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ models.py           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ service.py          # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ grok/
â”‚   â”‚       â””â”€â”€ services/
â”‚   â”‚           â””â”€â”€ assets.py       # æ–‡ä»¶ç®¡ç† (é›†æˆ)
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ storage.py              # å­˜å‚¨æœåŠ¡ (æ‰©å±•)
â”‚   â””â”€â”€ static/
â”‚       â”œâ”€â”€ gallery/
â”‚       â”‚   â”œâ”€â”€ gallery.html        # é¡µé¢ç»“æ„
â”‚       â”‚   â”œâ”€â”€ gallery.css         # æ ·å¼è®¾è®¡
â”‚       â”‚   â””â”€â”€ gallery.js          # äº¤äº’é€»è¾‘
â”‚       â””â”€â”€ common/
â”‚           â””â”€â”€ header.html         # å¯¼èˆªæ  (ä¿®æ”¹)
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ tmp/
â”‚   â”‚   â””â”€â”€ image/                  # å›¾ç‰‡æ–‡ä»¶
â”‚   â””â”€â”€ image_metadata.json         # å…ƒæ•°æ®æ–‡ä»¶
â”œâ”€â”€ test_gallery.py                 # é›†æˆæµ‹è¯•
â””â”€â”€ main.py                         # åº”ç”¨å…¥å£ (ä¿®æ”¹)
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

### å­˜å‚¨åç«¯é…ç½®

#### Local Storage (é»˜è®¤)

```bash
# æ— éœ€é…ç½®ï¼Œé»˜è®¤ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å­˜å‚¨
```

**æ•°æ®ä½ç½®**:
- å›¾ç‰‡æ–‡ä»¶: `data/tmp/image/`
- å…ƒæ•°æ®: `data/image_metadata.json`

#### Redis Storage

```bash
export SERVER_STORAGE_TYPE=redis
export SERVER_STORAGE_URL=redis://localhost:6379/0
```

**ä¼˜åŠ¿**:
- é«˜æ€§èƒ½
- æ”¯æŒåˆ†å¸ƒå¼
- é€‚åˆå¤§é‡å›¾ç‰‡

#### MySQL Storage

```bash
export SERVER_STORAGE_TYPE=mysql
export SERVER_STORAGE_URL=mysql://user:password@localhost:3306/grok2api
```

**ä¼˜åŠ¿**:
- å…³ç³»å‹æ•°æ®åº“
- æ”¯æŒå¤æ‚æŸ¥è¯¢
- æ•°æ®æŒä¹…åŒ–

#### PostgreSQL Storage

```bash
export SERVER_STORAGE_TYPE=pgsql
export SERVER_STORAGE_URL=postgresql://user:password@localhost:5432/grok2api
```

**ä¼˜åŠ¿**:
- åŠŸèƒ½å¼ºå¤§
- æ”¯æŒ JSON å­—æ®µ
- é«˜çº§æŸ¥è¯¢

### åˆ†é¡µé…ç½®

ä¿®æ”¹ `app/static/gallery/gallery.js`:

```javascript
const state = {
    pageSize: 50,  // æ¯é¡µæ˜¾ç¤ºæ•°é‡ï¼Œå¯ä¿®æ”¹ä¸º 20, 100 ç­‰
    // ...
};
```

### ç¼“å­˜é…ç½®

ä¿®æ”¹ `app/core/config.py`:

```python
# ç¼“å­˜è‡ªåŠ¨æ¸…ç†
cache.enable_auto_clean = True
cache.limit_mb = 1000  # ç¼“å­˜å¤§å°é™åˆ¶ (MB)
```

---

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python test_gallery.py

# é¢„æœŸè¾“å‡º
============================================================
å›¾ç‰‡ç®¡ç†åŠŸèƒ½é›†æˆæµ‹è¯•
============================================================

1. æµ‹è¯•å­˜å‚¨æœåŠ¡...
[PASS] - Storage Service - Load Metadata
[PASS] - Storage Service - Save Metadata

2. æµ‹è¯•æ•°æ®æ¨¡å‹...
[PASS] - Gallery Models - ImageMetadata
[PASS] - Gallery Models - ImageFilter
[PASS] - Gallery Models - ImageStats

...

============================================================
æµ‹è¯•ç»“æœæ±‡æ€»
============================================================
Total tests: 30
Passed: 29
Failed: 1
Pass rate: 96.7%
============================================================
```

### æµ‹è¯•è¦†ç›–

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•æ•° | é€šè¿‡ | å¤±è´¥ |
|----------|--------|------|------|
| å­˜å‚¨æœåŠ¡ | 2 | 2 | 0 |
| æ•°æ®æ¨¡å‹ | 3 | 3 | 0 |
| å›¾ç‰‡ç®¡ç†æœåŠ¡ | 7 | 7 | 0 |
| API å¯¼å…¥ | 8 | 8 | 0 |
| æ–‡ä»¶ç»“æ„ | 9 | 9 | 0 |
| é›†æˆæµ‹è¯• | 1 | 0 | 1* |
| **æ€»è®¡** | **30** | **29** | **1** |

*æ³¨: é›†æˆæµ‹è¯•å¤±è´¥æ˜¯ç”±äºç¼ºå°‘ `curl_cffi` ä¾èµ–ï¼Œä¸å½±å“å›¾ç‰‡ç®¡ç†åŠŸèƒ½

### æ‰‹åŠ¨æµ‹è¯•

å‚è€ƒ [GALLERY_DEMO_GUIDE.md](GALLERY_DEMO_GUIDE.md) è¿›è¡Œå®Œæ•´çš„åŠŸèƒ½æ¼”ç¤ºå’ŒéªŒè¯ã€‚

---

## ğŸ“š æ–‡æ¡£

### å®Œæ•´æ–‡æ¡£åˆ—è¡¨

| æ–‡æ¡£ | è¯´æ˜ | é€‚åˆäººç¾¤ |
|------|------|----------|
| [GALLERY_QUICKSTART.md](GALLERY_QUICKSTART.md) | å¿«é€Ÿå¼€å§‹æŒ‡å— | æ–°ç”¨æˆ· |
| [GALLERY_DEMO_GUIDE.md](GALLERY_DEMO_GUIDE.md) | åŠŸèƒ½æ¼”ç¤ºæŒ‡å— | æµ‹è¯•äººå‘˜ |
| [GALLERY_IMPLEMENTATION.md](GALLERY_IMPLEMENTATION.md) | å®æ–½æ–‡æ¡£ | å¼€å‘äººå‘˜ |
| [GALLERY_COMPLETION_REPORT.md](GALLERY_COMPLETION_REPORT.md) | å®ŒæˆæŠ¥å‘Š | é¡¹ç›®ç»ç† |
| [GALLERY_FINAL_SUMMARY.md](GALLERY_FINAL_SUMMARY.md) | æœ€ç»ˆæ€»ç»“ | æ‰€æœ‰äºº |

### å¿«é€Ÿé“¾æ¥

- **å¿«é€Ÿå¼€å§‹**: [GALLERY_QUICKSTART.md](GALLERY_QUICKSTART.md)
- **åŠŸèƒ½æ¼”ç¤º**: [GALLERY_DEMO_GUIDE.md](GALLERY_DEMO_GUIDE.md)
- **API æ–‡æ¡£**: è§ä¸Šæ–¹ [API æ–‡æ¡£](#-api-æ–‡æ¡£) ç« èŠ‚
- **æ•…éšœæ’é™¤**: [GALLERY_QUICKSTART.md#æ•…éšœæ’é™¤](GALLERY_QUICKSTART.md#-æ•…éšœæ’é™¤)

---

## â“ å¸¸è§é—®é¢˜

### Q1: å›¾ç‰‡ç®¡ç†é¡µé¢æ— æ³•è®¿é—®ï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç¡®è®¤æœåŠ¡å·²å¯åŠ¨: `ps aux | grep python`
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨: `netstat -ano | findstr :8000`
3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—: `tail -f logs/app.log`

### Q2: å›¾ç‰‡å…ƒæ•°æ®æœªä¿å­˜ï¼Ÿ

**A**: å¯èƒ½çš„åŸå› ï¼š
1. æ£€æŸ¥ `data/` ç›®å½•æ˜¯å¦æœ‰å†™å…¥æƒé™
2. æŸ¥çœ‹æœåŠ¡æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤å­˜å‚¨æœåŠ¡æ­£å¸¸å·¥ä½œ

### Q3: å›¾ç‰‡æ˜¾ç¤ºä¸å‡ºæ¥ï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç¡®è®¤å›¾ç‰‡æ–‡ä»¶å­˜åœ¨äº `data/tmp/image/` ç›®å½•
2. æ£€æŸ¥æ–‡ä»¶æœåŠ¡è·¯ç”± `/v1/files/image/` æ˜¯å¦æ­£å¸¸
3. æŸ¥çœ‹æµè§ˆå™¨ç½‘ç»œè¯·æ±‚æ˜¯å¦æˆåŠŸ

### Q4: å¦‚ä½•æ¸…ç†å­¤ç«‹çš„å…ƒæ•°æ®ï¼Ÿ

**A**: è¿è¡Œæ¸…ç†è„šæœ¬ï¼š
```python
import asyncio
from app.services.gallery.service import get_image_metadata_service

async def cleanup():
    service = get_image_metadata_service()
    count = await service.cleanup_orphaned_metadata()
    print(f"Cleaned up {count} orphaned metadata entries")

asyncio.run(cleanup())
```

### Q5: å¦‚ä½•åˆ‡æ¢å­˜å‚¨åç«¯ï¼Ÿ

**A**: è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
# Redis
export SERVER_STORAGE_TYPE=redis
export SERVER_STORAGE_URL=redis://localhost:6379/0

# MySQL
export SERVER_STORAGE_TYPE=mysql
export SERVER_STORAGE_URL=mysql://user:password@localhost:3306/grok2api
```

### Q6: å¦‚ä½•æé«˜æ€§èƒ½ï¼Ÿ

**A**: å»ºè®®ï¼š
1. ä½¿ç”¨ Redis æˆ– SQL å­˜å‚¨åç«¯
2. å®šæœŸæ¸…ç†ä¸éœ€è¦çš„å›¾ç‰‡
3. è°ƒæ•´åˆ†é¡µå¤§å°
4. å¯ç”¨ç¼“å­˜

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¦‚ä½•è´¡çŒ®

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯: `git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹: `git commit -m 'Add amazing feature'`
4. æ¨é€åˆ°åˆ†æ”¯: `git push origin feature/amazing-feature`
5. æäº¤ Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ª PEP 8 Python ä»£ç è§„èŒƒ
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

### æŠ¥å‘Šé—®é¢˜

å¦‚æœå‘ç° bug æˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Œè¯·åœ¨ [GitHub Issues](https://github.com/chenyme/grok2api/issues) æäº¤ã€‚

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…å’Œç”¨æˆ·ï¼

---

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub**: https://github.com/chenyme/grok2api
- **Issues**: https://github.com/chenyme/grok2api/issues
- **ä½œè€…**: @chenyme

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª Starï¼**

Made with â¤ï¸ by the Grok2API Team

</div>
